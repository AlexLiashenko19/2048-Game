!function(){var t,e,n,r,i={},o=(i={onTouchStart:function(n){n.preventDefault();var r=n.touches[0];t=r.pageX,e=r.pageY},onTouchEnd:function(i){var o=i.changedTouches[0];n=o.pageX,r=o.pageY;var s=n-t,a=r-e;if(Math.abs(s)>Math.abs(a)){if(s>15)return i.key="ArrowRight",i;if(s<-15)return i.key="ArrowLeft",i}return a>15?(i.key="ArrowDown",i):a<-15?(i.key="ArrowUp",i):void 0}}).onTouchStart,s=i.onTouchEnd,a={};function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function c(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return u(t,void 0);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(t,void 0)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}Object.defineProperty(a,"gameField",{get:function(){return l},set:void 0,enumerable:!0,configurable:!0});var l=document.querySelector(".game-field tbody"),f={left:function(t,e){return function(t,e){for(var n=0;n<t.length;n++)for(var r=t[n],i=r.length-1,o=0,s=!1,a=0;a<i&&!s;a++){if(a===o&&r[a]===e[n][a]){o++;continue}if(!r[a]){s=!0,r.splice(a,1),r.push(0);continue}r[a+1]&&r[a]===r[a+1]&&(s=!0,r[a]=2*+r[a],r.splice(a+1,1),r.push(0))}return t}(t,e)},right:function(t,e){return function(t,e){for(var n=0;n<t.length;n++)for(var r=t[n],i=!1,o=r.length-1,s=r.length-1;s>0&&!i;s--){if(s===o&&r[s]===e[n][s]){o--;continue}if(!r[s]){i=!0,r.splice(s,1),r.unshift(0);continue}r[s-1]&&r[s]===r[s-1]&&(i=!0,r[s]=2*+r[s],r.splice(s-1,1),r.unshift(0))}return t}(t,e)},up:function(t,e){return function(t,e){for(var n=0;n<t.length;n++)for(var r=t.length-1,i=0,o=!1,s=0;s<r&&!o;s++){if(s===i&&t[s][n]===e[s][n]){i++;continue}if(!t[s][n]){o=!0,y(t,s,n);continue}t[s+1][n]&&t[s][n]===t[s+1][n]&&(t[s][n]*=2,o=!0,y(t,s+1,n))}return t}(t,e)},down:function(t,e){return function(t,e){for(var n=0;n<t.length;n++)for(var r=!1,i=t.length-1,o=t.length-1;o>0&&!r;o--){if(i===o&&t[o][n]===e[o][n]){i--;continue}if(!t[o][n]){r=!0,p(t,o,n);continue}t[o-1][n]&&t[o][n]===t[o-1][n]&&(t[o][n]=2*+t[o][n],r=!0,p(t,o-1,n))}return t}(t,e)}},h=null,d=null;function v(t,e){for(var n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++)if(t[n][r]!==e[n][r])return!0;return!1}function g(t){return t.map(function(t){return c(t)})}function m(t){for(var e=0;e<t.length;e++)for(var n=t[e],r=0;r<n.length;r++)t[e][r]&&(l.rows[e].cells[r].textContent=t[e][r],l.rows[e].cells[r].classList.add("field-cell--".concat(t[e][r])))}function y(t,e,n){for(var r=t.length-1,i=e;i<r;i++)t[i][n]=t[i+1][n];t[r][n]=0}function p(t,e,n){for(var r=e;r>0;r--)t[r][n]=t[r-1][n];t[0][n]=0}function w(){for(var t=[],e=0;e<l.rows.length;e++){t.push([]);for(var n=l.rows[e].cells,r=0;r<n.length;r++)t[e].push(+n[r].textContent),n[r].textContent&&(n[r].classList.remove("field-cell--".concat(n[r].textContent)),n[r].textContent="")}return t}var k=(a={updateField:function(t,e){if(h){if(!v(h,t))return;clearTimeout(d),w(),m(h),h=null,d=null}var n=[g(w())];if(!v(n[0],t)){m(t);return}if(e){for(;;)if(n.push(g(f[e](g(n.at(-1)),t))),!v(n.at(-1),n.at(-2))){n.pop(),n.shift(),n[n.length-1]=t;break}h=t,function t(e,n){if(w(),m(e.shift()),e.length){d=setTimeout(t,n,e,n);return}h=null,d=null}(n,250/n.length);return}m(t)},isChanged:v}).gameField,b=a.updateField,L=a.isChanged;function S(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function C(t,e){return Math.floor(Math.random()*(e-t))+t}var R=new/*#__PURE__*/(function(){var t;function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.createField();!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,e),S(this,"size",4),S(this,"probability",10),S(this,"status",{started:!1,lost:!1,won:!1}),S(this,"score",0),this.state=t,this.initialState=this.copyState(t)}return t=[{key:"start",value:function(){if(!this.isPlaying){this.status.started=!0;for(var t=0;t<2;t++)this.addRandomCell()}}},{key:"restart",value:function(){this.score=0,this.state=this.copyState(this.initialState),this.status.won=!1,this.status.lost=!1,this.status.started=!1}},{key:"moveRow",value:function(t){if(this.isPlaying){for(var e=this.getState(),n=0;n<this.size;n++)this.state[n]=this.stackRow(this.state[n],t);this.isChanged(e)&&(this.addRandomCell(),this.status.lost=this.isLost)}}},{key:"moveColumn",value:function(t){var e=this,n=function(n){e.stackRow(e.state.map(function(t){return t[n]}),t).forEach(function(t,e){return r.state[e][n]=t})},r=this;if(this.isPlaying){for(var i=this.getState(),o=0;o<this.size;o++)n(o);this.isChanged(i)&&(this.addRandomCell(),this.status.lost=this.isLost)}}},{key:"stackRow",value:function(t,e){for(var n=t.filter(Boolean),r=1;r<n.length;r++)if(n[r-1]===n[r]){var i=2*n[r-1];2048===i&&(this.status.won=!0),n[r-1]=i,this.score+=i,n.splice(r,1)}for(;n.length!==this.size;)e(n);return n}},{key:"moveLeft",value:function(){this.moveRow(function(t){return t.push(0)})}},{key:"moveRight",value:function(){this.moveRow(function(t){return t.unshift(0)})}},{key:"moveUp",value:function(){this.moveColumn(function(t){return t.push(0)})}},{key:"moveDown",value:function(){this.moveColumn(function(t){return t.unshift(0)})}},{key:"createField",value:function(){var t=this;return Array(this.size).fill(null).map(function(){return Array(t.size).fill(0)})}},{key:"copyState",value:function(t){return t.map(function(t){return c(t)})}},{key:"isChanged",value:function(t){for(var e=0;e<this.size;e++)for(var n=0;n<this.size;n++)if(t[e][n]!==this.state[e][n])return!0;return!1}},{key:"isPlaying",get:function(){switch(!0){case!this.status.started:case this.status.won:case this.status.lost:return!1;default:return!0}}},{key:"isLost",get:function(){for(var t=this,e=function(e){var n=t.state.map(function(t){return t[e]});if(t.hasMoves(t.state[e])||t.hasMoves(n))return{v:!1}},n=0;n<this.size;n++){var r=e(n);if("object"==(r&&"undefined"!=typeof Symbol&&r.constructor===Symbol?"symbol":typeof r))return r.v}return!0}},{key:"hasMoves",value:function(t){if(t.includes(0))return!0;for(var e=1;e<t.length;e++)if(t[e-1]===t[e])return!0;return!1}},{key:"addRandomCell",value:function(){var t=this.getRandomRow(),e=this.getRandomColumn(t);this.state[t][e]=C(0,this.probability)?2:4}},{key:"getRandomRow",value:function(){for(var t=[],e=0;e<this.size;e++)this.state[e].includes(0)&&t.push(e);return t[C(0,t.length)]}},{key:"getRandomColumn",value:function(t){for(var e=[],n=this.state[t],r=0;r<n.length;r++)n[r]||e.push(r);return e[C(0,e.length)]}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){return this.copyState(this.state)}},{key:"getStatus",value:function(){switch(!0){case!this.status.started:return"idle";case this.status.won:return"win";case this.status.lost:return"lose"}return"playing"}}],function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,t),e}()),A=document.querySelector(".game-score"),E=document.querySelector(".button.start"),z=document.querySelector(".message.message-win"),T=document.querySelector(".message.message-lose"),x=document.querySelector(".message.message-start");function M(t){var e=s(t);e&&j(e)}function j(t){var e=R.getState();switch(t.key){case"ArrowUp":R.moveUp();break;case"ArrowRight":R.moveRight();break;case"ArrowDown":R.moveDown();break;case"ArrowLeft":R.moveLeft();break;default:return}E.classList.contains("start")&&L(e,R.getState())&&(E.disabled=!1,E.textContent="Restart",E.classList.add("restart"),E.classList.remove("start")),A.textContent=R.getScore(),b(R.getState(),t.key.replace("Arrow","").toLowerCase());var n=R.getStatus();if("playing"!==n){if(document.removeEventListener("keydown",j),k.removeEventListener("touchstart",o),k.removeEventListener("touchend",M),"win"===n){z.classList.remove("hidden");return}T.classList.remove("hidden")}}E.addEventListener("click",function(){if(E.classList.contains("start")){R.start(),b(R.getState()),x.classList.add("hidden"),E.disabled=!0,document.addEventListener("keydown",j),k.addEventListener("touchstart",o,!1),k.addEventListener("touchend",M,!1);return}R.restart(),R.start(),b(R.getState()),A.textContent="0",z.classList.contains("hidden")||z.classList.add("hidden"),T.classList.contains("hidden")||T.classList.add("hidden"),k.removeEventListener("touchstart",o),k.removeEventListener("touchend",M),k.addEventListener("touchstart",o,!1),k.addEventListener("touchend",M,!1),document.removeEventListener("keydown",j),document.addEventListener("keydown",j)})}();
//# sourceMappingURL=index.86edea4d.js.map
