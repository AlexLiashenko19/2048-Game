let t,e,s,n;var i={},r=(i={onTouchStart:function(s){s.preventDefault();let n=s.touches[0];t=n.pageX,e=n.pageY},onTouchEnd:function(i){let r=i.changedTouches[0];s=r.pageX,n=r.pageY;let o=s-t,a=n-e;if(Math.abs(o)>Math.abs(a)){if(o>15)return i.key="ArrowRight",i;if(o<-15)return i.key="ArrowLeft",i}return a>15?(i.key="ArrowDown",i):a<-15?(i.key="ArrowUp",i):void 0}}).onTouchStart,o=i.onTouchEnd,a={};Object.defineProperty(a,"gameField",{get:function(){return l},set:void 0,enumerable:!0,configurable:!0});const l=document.querySelector(".game-field tbody"),u={left:(t,e)=>(function(t,e){for(let s=0;s<t.length;s++){let n=t[s],i=n.length-1,r=0,o=!1;for(let t=0;t<i&&!o;t++){if(t===r&&n[t]===e[s][t]){r++;continue}if(!n[t]){o=!0,n.splice(t,1),n.push(0);continue}n[t+1]&&n[t]===n[t+1]&&(o=!0,n[t]=2*+n[t],n.splice(t+1,1),n.push(0))}}return t})(t,e),right:(t,e)=>(function(t,e){for(let s=0;s<t.length;s++){let n=t[s],i=!1,r=n.length-1;for(let t=n.length-1;t>0&&!i;t--){if(t===r&&n[t]===e[s][t]){r--;continue}if(!n[t]){i=!0,n.splice(t,1),n.unshift(0);continue}n[t-1]&&n[t]===n[t-1]&&(i=!0,n[t]=2*+n[t],n.splice(t-1,1),n.unshift(0))}}return t})(t,e),up:(t,e)=>(function(t,e){for(let s=0;s<t.length;s++){let n=t.length-1,i=0,r=!1;for(let o=0;o<n&&!r;o++){if(o===i&&t[o][s]===e[o][s]){i++;continue}if(!t[o][s]){r=!0,m(t,o,s);continue}t[o+1][s]&&t[o][s]===t[o+1][s]&&(t[o][s]*=2,r=!0,m(t,o+1,s))}}return t})(t,e),down:(t,e)=>(function(t,e){for(let s=0;s<t.length;s++){let n=!1,i=t.length-1;for(let r=t.length-1;r>0&&!n;r--){if(i===r&&t[r][s]===e[r][s]){i--;continue}if(!t[r][s]){n=!0,v(t,r,s);continue}t[r-1][s]&&t[r][s]===t[r-1][s]&&(t[r][s]=2*+t[r][s],n=!0,v(t,r-1,s))}}return t})(t,e)};let h=null,c=null;function d(t,e){for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++)if(t[s][n]!==e[s][n])return!0;return!1}function f(t){return t.map(t=>[...t])}function g(t){for(let e=0;e<t.length;e++){let s=t[e];for(let n=0;n<s.length;n++)t[e][n]&&(l.rows[e].cells[n].textContent=t[e][n],l.rows[e].cells[n].classList.add(`field-cell--${t[e][n]}`))}}function m(t,e,s){let n=t.length-1;for(let i=e;i<n;i++)t[i][s]=t[i+1][s];t[n][s]=0}function v(t,e,s){for(let n=e;n>0;n--)t[n][s]=t[n-1][s];t[0][s]=0}function p(){let t=[];for(let e=0;e<l.rows.length;e++){t.push([]);let s=l.rows[e].cells;for(let n=0;n<s.length;n++)t[e].push(+s[n].textContent),s[n].textContent&&(s[n].classList.remove(`field-cell--${s[n].textContent}`),s[n].textContent="")}return t}var w=(a={updateField:function(t,e){if(h){if(!d(h,t))return;clearTimeout(c),p(),g(h),h=null,c=null}let s=[f(p())];if(!d(s[0],t)){g(t);return}if(e){for(;;)if(s.push(f(u[e](f(s.at(-1)),t))),!d(s.at(-1),s.at(-2))){s.pop(),s.shift(),s[s.length-1]=t;break}h=t,function t(e,s){if(p(),g(e.shift()),e.length){c=setTimeout(t,s,e,s);return}h=null,c=null}(s,250/s.length);return}g(t)},isChanged:d}).gameField,L=a.updateField,y=a.isChanged;function S(t,e){return Math.floor(Math.random()*(e-t))+t}const C=new class{size=4;probability=10;status={started:!1,lost:!1,won:!1};score=0;constructor(t=this.createField()){this.state=t,this.initialState=this.copyState(t)}start(){if(!this.isPlaying){this.status.started=!0;for(let t=0;t<2;t++)this.addRandomCell()}}restart(){this.score=0,this.state=this.copyState(this.initialState),this.status.won=!1,this.status.lost=!1,this.status.started=!1}moveRow(t){if(!this.isPlaying)return;let e=this.getState();for(let e=0;e<this.size;e++)this.state[e]=this.stackRow(this.state[e],t);this.isChanged(e)&&(this.addRandomCell(),this.status.lost=this.isLost)}moveColumn(t){if(!this.isPlaying)return;let e=this.getState();for(let e=0;e<this.size;e++)this.stackRow(this.state.map(t=>t[e]),t).forEach((t,s)=>this.state[s][e]=t);this.isChanged(e)&&(this.addRandomCell(),this.status.lost=this.isLost)}stackRow(t,e){let s=t.filter(Boolean);for(let t=1;t<s.length;t++)if(s[t-1]===s[t]){let e=2*s[t-1];2048===e&&(this.status.won=!0),s[t-1]=e,this.score+=e,s.splice(t,1)}for(;s.length!==this.size;)e(s);return s}moveLeft(){this.moveRow(t=>t.push(0))}moveRight(){this.moveRow(t=>t.unshift(0))}moveUp(){this.moveColumn(t=>t.push(0))}moveDown(){this.moveColumn(t=>t.unshift(0))}createField(){return Array(this.size).fill(null).map(()=>Array(this.size).fill(0))}copyState(t){return t.map(t=>[...t])}isChanged(t){for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++)if(t[e][s]!==this.state[e][s])return!0;return!1}get isPlaying(){switch(!0){case!this.status.started:case this.status.won:case this.status.lost:return!1;default:return!0}}get isLost(){for(let t=0;t<this.size;t++){let e=this.state.map(e=>e[t]);if(this.hasMoves(this.state[t])||this.hasMoves(e))return!1}return!0}hasMoves(t){if(t.includes(0))return!0;for(let e=1;e<t.length;e++)if(t[e-1]===t[e])return!0;return!1}addRandomCell(){let t=this.getRandomRow(),e=this.getRandomColumn(t);this.state[t][e]=S(0,this.probability)?2:4}getRandomRow(){let t=[];for(let e=0;e<this.size;e++)this.state[e].includes(0)&&t.push(e);return t[S(0,t.length)]}getRandomColumn(t){let e=[],s=this.state[t];for(let t=0;t<s.length;t++)s[t]||e.push(t);return e[S(0,e.length)]}getScore(){return this.score}getState(){return this.copyState(this.state)}getStatus(){switch(!0){case!this.status.started:return"idle";case this.status.won:return"win";case this.status.lost:return"lose"}return"playing"}},R=document.querySelector(".game-score"),k=document.querySelector(".button.start"),b=document.querySelector(".message.message-win"),E=document.querySelector(".message.message-lose"),A=document.querySelector(".message.message-start");function z(t){let e=o(t);e&&x(e)}function x(t){let e=C.getState();switch(t.key){case"ArrowUp":C.moveUp();break;case"ArrowRight":C.moveRight();break;case"ArrowDown":C.moveDown();break;case"ArrowLeft":C.moveLeft();break;default:return}k.classList.contains("start")&&y(e,C.getState())&&(k.disabled=!1,k.textContent="Restart",k.classList.add("restart"),k.classList.remove("start")),R.textContent=C.getScore(),L(C.getState(),t.key.replace("Arrow","").toLowerCase());let s=C.getStatus();if("playing"!==s){if(document.removeEventListener("keydown",x),w.removeEventListener("touchstart",r),w.removeEventListener("touchend",z),"win"===s){b.classList.remove("hidden");return}E.classList.remove("hidden")}}k.addEventListener("click",()=>{if(k.classList.contains("start")){C.start(),L(C.getState()),A.classList.add("hidden"),k.disabled=!0,document.addEventListener("keydown",x),w.addEventListener("touchstart",r,!1),w.addEventListener("touchend",z,!1);return}C.restart(),C.start(),L(C.getState()),R.textContent="0",b.classList.contains("hidden")||b.classList.add("hidden"),E.classList.contains("hidden")||E.classList.add("hidden"),w.removeEventListener("touchstart",r),w.removeEventListener("touchend",z),w.addEventListener("touchstart",r,!1),w.addEventListener("touchend",z,!1),document.removeEventListener("keydown",x),document.addEventListener("keydown",x)});
//# sourceMappingURL=index.4c648676.js.map
